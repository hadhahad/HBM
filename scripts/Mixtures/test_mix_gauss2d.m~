clc;
clear all; %#ok<CLALL>

% Initial parameters:
mu1 = [1 1];
mu2 = [-1 1];
mu3 = [0 -1];
Sig1 = eye(2);
Sig2 = eye(2);
Sig3 = diag([2, 0.1]);
N = [300,300,400];

plot_truepdf = true;
plot_sample = true;

%% Plot True Probability Density
if plot_truepdf
    x = -2:0.1:2;
    y = -2:0.1:2;
    [X_axis,Y_axis] = meshgrid(x, y);
    F1 = mvnpdf([X_axis(:) Y_axis(:)], mu1, Sig1);
    F1 = reshape(F1,length(Y_axis),length(X_axis));
    F2 = mvnpdf([X_axis(:) Y_axis(:)], mu2, Sig2);
    F2 = reshape(F2,length(Y_axis),length(X_axis));
    F3 = mvnpdf([X_axis(:) Y_axis(:)], mu3, Sig3);
    F3 = reshape(F3,length(Y_axis),length(X_axis));
    figure(1);
    surf(x,y,F1);
    hold on;
    surf(x,y,F2);
    hold on;
    surf(x,y,F3);
    xlabel('x'); ylabel('y'); zlabel('Probability Density');
end

%% Random Samples
rng default  % For reproducibility
R = [mvnrnd(mu1,Sig1,N(1)); mvnrnd(mu2,Sig2,N(2));mvnrnd(mu3,Sig3,N(3))];
if plot_sample
    plot

%%
K=3;
[mu,sig,L,Smu,DBG]=mixture_gauss1D(x,K,4)
%%

[hy,hx]=hist(x,40);

sL = sum(L,1);
figure(1); 
hold off
bar(hx,hy);
hold on
for k=1:K
    fest = exp(-0.5*(hx-mu(k)).^2/sig(k));
    f = sL(k)*fest/sum(fest);
    plot(hx,f,'LineWidth',3);
end